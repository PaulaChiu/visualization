<!-- 
https://dev.socrata.com/blog/2017/01/03/visualizing-data-using-google-calendar-chart.html 
-->

<html>
  <head>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript" src="https://www.google.com/jsapi"></script>
    <script
  src="https://code.jquery.com/jquery-3.1.1.min.js"
  integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
  crossorigin="anonymous"></script>
   
  </head>
  <body>
    <div id="calendar_basic" style="width: 1000px; height: 600px;"></div>

    <script type="text/javascript">
(function() {
  // Initialize the charting library
  google.charts.load("current", { packages:["calendar"] });

  var fetchValues = function() {
    return $.get(
      'https://data.cityofchicago.org/resource/6zsd-86xi.json',
      {
        '$select' : 'date_trunc_ymd(date) as day, count(*)',
        '$where' : "date > '2014-01-01'",
        '$group' : 'day'
      }
    ).pipe(function(res) {
      var ary = []
      $.each(res, function(idx, rec) {
        ary.push([new Date(rec.day.replace("T00:00:00", "T12:00:00")), parseInt(rec.count)]);
      });
      return ary;
    });
  };

  var drawChart = function(ary) {
    var data = new google.visualization.DataTable();
    data.addColumn({ type: 'date', id: 'Date' });
    data.addColumn({ type: 'number', id: 'count' });
    data.addRows(ary);

    var chart = new google.visualization.Calendar(document.getElementById('calendar_basic'));
    var options = {
      title: "City of Chicago Police Incidents Over Time",
      height: 600,
    };

    chart.draw(data, options);
  };

  google.charts.setOnLoadCallback(function() {
    fetchValues().done(function(data) {
      drawChart(data);
    });
  });
})();
    </script>
  </body>
</html>